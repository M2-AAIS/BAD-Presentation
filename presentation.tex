\documentclass[french]{beamer}
\setbeamertemplate{navigation symbols}{}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{graphicx}

%\usepackage[abs]{overpic}
\graphicspath{{figures/}}
\usepackage{xcolor}
%\usetheme{Warsaw}

%%%%autre theme possible
\usetheme{Hannover}
\useoutertheme{infolines}
%%%%%%%%
\hypersetup{pdfpagemode=FullScreen}

\usepackage{siunitx}
\usepackage[]{algorithm2e}

\usepackage{caption}
\captionsetup{font=scriptsize,labelfont=scriptsize}
\setbeamertemplate{caption}[numbered]

\usepackage{amsmath}
\DeclareMathOperator{\sinc}{sinc}
\DeclareMathOperator{\e}{e}

\begin{document}

% \begin{frame}
%    \frametitle{Courbe en S}
%    \framesubtitle{Sommaire}
%    \tableofcontents[currentsection]
% \end{frame}

\AtBeginSection[]
{
  \begin{frame}
    \frametitle{Sommaire}
    \tableofcontents[currentsection]
  \end{frame}
}



%_______________________________________
\section{Présentation du problème}
\begin{frame}
\frametitle{Mise en équation}

   \begin{itemize}
      \item Équation thermique
      \begin{equation}
         Cv\frac{\partial T}{\partial t} = Q^+ + Q^- +Q^{adv}
      \end{equation}
      
   \item Équilibre thermique local
   \begin{equation}
      Q^+ = Q^- 
   \end{equation}
   
      \begin{itemize}
         \item état stationnaire
         \\
         \item dépend de la position
         \item courbes en S pour 256 valeurs du rayon
      \end{itemize}
\end{itemize}
\end{frame}
%_______________________________________

%_______________________________________
\section{Résolution des équations}
\begin{frame}
\frametitle{Résolution des équations}

   \begin{itemize}
      \item Ordre des équations
      \item Détermination de la température
      \item Méthodes de résolution
         \begin{itemize} 
            \item Dichotomie
            \item Amélioration de la dichotomie
            \item Méthode de Brent
            \item Comparaison des différentes méthodes
         \end{itemize}
      \item Épaisseur optique
   \end{itemize}
\end{frame}
%_______________________________________

%_______________________________________

%_______________________________________
\begin{frame}
\frametitle{Ordre des équations}
      
   \begin{figure}[htb!]
      \includegraphics[width=9cm]{figures/bob_ross.png}
      \caption{Schéma très simplifié du disque d'accrétion autour d'un trou noir.}
   \end{figure}      
      \end{frame}

\begin{frame}
\frametitle{Ordre des équations}
         \begin{itemize}
      \item Demi-hauteur H du disque

      Solution d'une équation quadratique trouvée à partir de la pression :
      \begin{equation}
         P = P_\mathrm{gaz} + P_\mathrm{rad}
      \end{equation}
      \item Densité volumique $\rho$
      \item Vitesse du son $c_s$ 
      \item Viscosité $\nu$ 
      \item Flux radiatif $F_z$
      \\
      2 approximations en fonction de la profondeur optique $\tau_{eff}$
   \end{itemize}
\end{frame}
%_______________________________________


%_______________________________________

\begin{frame}
\frametitle{Détermination de l'intervalle de Température} 
Luminosité d'Eddington
   \begin{equation}
      L_\mathrm{Edd} = \frac{4\pi GMm_pc}{\sigma_e}
   \end{equation}

Taux d’accrétion critique 
   \begin{equation}
      \dot{M}_\mathrm{crit} = \frac{12}{c^2}L_\mathrm{Edd} 
   \end{equation}

Température caractéristique $T_0$
   \begin{equation}
      T_0 \approx 2,50.10^7\left(\frac{\dot{M}_0}{\dot{L}_\mathrm{crit}}\right)^{\frac{1}{4}}\left(\frac{M}{M_\odot}\right)^{-\frac{1}{4}} \mathrm{K}
   \end{equation}


\end{frame}
%_______________________________________


%_______________________________________

%\begin{frame}
%\frametitle{Détermination de l'intervalle de Température} 

 %  Finalement : 
%\begin{eqnarray}


 %  T_0 =1.40\ 10^6 \mathrm{K} 
   
 %  T_\textrm{min} = 2.9\ 10^5 \mathrm{K}
    
 %  T_\textrm{max} = 6.2\ 10^6 \mathrm{K} 
%\end{eqnarray}

%\end{frame}
%_______________________________________


%_______________________________________

\begin{frame}
\frametitle{Dichotomie}

   \begin{itemize}
      \item Racine $f(\Sigma) = Q^+ - Q^- = 0$ comprise dans un intervalle $[\Sigma_{min}$ ; $\Sigma_{max}]$
      \\
      \begin{figure}[htb!]
         \includegraphics[width=8cm]{figures/dicho_1.png}
      \end{figure}
   \end{itemize}
\end{frame}
%_______________________________________

%_______________________________________

\begin{frame}
\frametitle{Dichotomie}

   \begin{itemize}
      \item Racine $f(\Sigma) = Q^+ - Q^- = 0$ 
      
      comprise dans un intervalle $[\Sigma_{min}$ ; $\Sigma_{max}]$
      \\
      \begin{figure}[htb!]
         \includegraphics[width=8cm]{figures/dicho_2.png}
      \end{figure}
   \end{itemize}
\end{frame}
%_______________________________________


%_______________________________________

\begin{frame}
\frametitle{Amélioration de la dichotomie}
\framesubtitle{Méthode de Newton}
%\setbeamertemplate{itemize item}[square]

   \begin{itemize}
      \item Présentation
      \\
      \begin{equation}
         x_{k+1} = x_k - \frac{f(x_k)}{f'(x_k)}
      \end{equation}

      \begin{figure}[htb!]
         \includegraphics[width=3cm]{figures/Newton_method.png}
         \caption{Illustration de la méthode de Newton. Crédit: Wikimedia Commons}
      \end{figure}

   \end{itemize}
\end{frame}
%_______________________________________

%_______________________________________

\begin{frame}
\frametitle{Amélioration de la dichotomie}
\framesubtitle{Méthode de Newton}
%\setbeamertemplate{itemize item}[square]

   \begin{itemize}
      \item Avantages :
         \begin{itemize}
            \item Convergence quadratique
         \end{itemize}
      \item Inconvénients :
      \begin{itemize}
         \item Nécessite le calcul littéral de la dérivée.
         \item La fonction doit être obligatoirement de classe $C^1$.
         \item S'il existe plusieurs racines, ne converge pas forcément vers la plus proche du point de départ.
      \end{itemize}
   \end{itemize}
\end{frame}
%_______________________________________

%_______________________________________

\begin{frame}
\frametitle{Méthode de Brent}

Combinaison des méthodes de la dichotomie, de la sécante et l'interpolation quadratique inverse pour en utiliser tous leurs avantages.

   \begin{itemize}
      \item Méthode quadratique inverse
    \begin{equation}\begin{aligned}
         x_{n+1} &= \frac{f(x_{n-1})f(x_n)}{(f(x_{n-2})-f(x_{n-1}))(f(x_{n-2})-f(x_{n}))}x_{n-2} \\
         &+  \frac{f(x_{n-2})f(x_n)}{(f(x_{n-1})-f(x_{n-2}))(f(x_{n-1})-f(x_{n}))}x_{n-1} \\
         &+ \frac{f(x_{n-2})f(x_{n-1})}{(f(x_{n})-f(x_{n-2}))(f(x_{n})-f(x_{n-1}))}x_{n} \\
    \end{aligned}
    \end{equation}  
     

     \item Méthode de la sécante

     \begin{equation}
        x_{n+1} = x_n - \frac{x_n - x_{n-1}}{f(x_n) - f(x_{n-1})}
     \end{equation}

   \end{itemize}
\end{frame}
%_______________________________________


%_______________________________________

\begin{frame}
\frametitle{Méthode de Brent}

   \begin{itemize}
      \item Si le dénominateur ne s'annule pas, on utilise la méthode quadratique inverse.
      \item Autrement on utilise la méthode de la sécante sauf s'il on est trop éloigné de la solution.
      \item Dans ce cas, on utilise la méthode de la dichotomie.
   \end{itemize}
\end{frame}
%_______________________________________


%_______________________________________

\begin{frame}
\frametitle{Comparaison des différentes méthodes}

   \begin{figure}[htb!]
      \includegraphics[width=9cm]{figures/brent_method3.pdf}
   \end{figure}
\end{frame}
%_______________________________________

%_______________________________________

\begin{frame}
\frametitle{Comparaison des différentes méthodes}

   \begin{tabular}{|c|c|c|}
     \hline
        Méthode & + & - \\
     \hline
     \\
     Dichotomie & simple & beaucoup d'itérations  
     \\  
     \hline
     \\
     Newton & plus rapide  & fonction dérivable 
     \\ 
     \hline
     \\  
     Sécante & pas de dérivée & intervalle de départ 
     \\  
     \hline  
     \\  
     Brent & interpolation quadratique inverse & convergence rapide 
     \\  
     \hline
   \end{tabular}
\end{frame}
%_______________________________________


%_______________________________________

\section{Détermination des points critiques}
\begin{frame}
\frametitle{Zones de stabilité}

   \begin{figure}[htb!]
      \includegraphics[width=8cm]{figures/stable.pdf}
      %LOG!!!
      \caption{Zones de stabilités de la courbe en S.}
    \end{figure}
\end{frame}
%_______________________________________

\begin{frame}		
\frametitle{Points critiques}		
		
   \begin{figure}[htb!]		
      \includegraphics[width=8cm]{figures/points_critiques.png}		
      \caption{Localisation des points critiques sur la courbe en S.}		
    \end{figure}		
\end{frame}		


%_______________________________________

\section{Épaisseur optique}
\begin{frame}

   \begin{figure}[htb!]
      \includegraphics[width=8cm]{figures/tau_map.pdf}
      %\caption{ }
   \end{figure}
\end{frame}
%_______________________________________

%_______________________________________
\section{Différence des termes Q+ et Q-}
\begin{frame}

   \begin{figure}[htb!]
      \includegraphics[width=8cm]{figures/Qmap.pdf}
     %\caption{ }
   \end{figure}
\end{frame}
%_______________________________________

%_______________________________________

\section{Discussion et conclusion}
\begin{frame}

   \begin{itemize}
      \item Non unicité des racines de $f(\Sigma) = 0$
      \\
         \begin{itemize}
            \item Interpolation du $\tau_{eff} \approx 1$ critique
            \item Existance de plusieurs branches minces ? 
         \end{itemize}  
      \item $\tau_{eff} \simeq 0.06 et \neq 1$ 
      \\
Simulation en accord avec la valeur théorique
   \end{itemize}
\end{frame}
%_______________________________________

%_______________________________________

\begin{frame}

   \begin{figure}[htb!]
      \includegraphics[width=9cm]{figures/S_curves_tau.eps}
      %\caption{ }
   \end{figure}
\end{frame}
%_______________________________________
%Parie équations adimmensinnement, CI et modèle alpha
\include{parametres}

\include{conditions_initiales}

\include{variables}

%_______________________________________
\section{Intégration}

\begin{frame}
    \frametitle{Dérivées numériques spatiales}
    Étude d’une perturbation $\delta{u} = \tilde{u}(t) \e^{ikr}$ de $u(r,t)$ dans :
    \begin{equation*}
        \frac{\partial u}{\partial t} + v \frac{\partial u}{\partial r} = 0
    \end{equation*}
    On a :
    \begin{align*}
        \frac{\partial u_j}{\partial r} &\approx \frac{u_{j+1} - u_j    }{  \Delta{r}} &&\Rightarrow \tilde{u} = \tilde{u(0)} \e^{-i k v t} \e^{ v\frac{k^2}{2}t}\\
        \frac{\partial u_j}{\partial r} &\approx \frac{u_j     - u_{j-1}}{  \Delta{r}} &&\Rightarrow \tilde{u} = \tilde{u(0)} \e^{-i k v t} \e^{-v\frac{k^2}{2}t}\\
        \frac{\partial u_j}{\partial r} &\approx \frac{u_{j+1} - u_{j-1}}{2 \Delta{r}} &&\Rightarrow \tilde{u} = \tilde{u(0)} \e^{-i k v t \sinc(k \Delta{r})}
    \end{align*}
    Dérivée « amont » :
    \begin{equation*}
        \frac{\partial u_j}{\partial r} = \frac{\max(v,0) \left[u_{j+1} - u_j \right] + \min(v,0) \left[u_j - u_{j-1}\right]}{\Delta{r}}
    \end{equation*}
\end{frame}

\begin{frame}
    \frametitle{Conditions aux bords}
\end{frame}

\include{condition_limite}

\begin{frame}
    \frametitle{Structure globale du code}
    Le code est découpée en plusieurs parties :
    \begin{itemize}
        \item Constantes et définitions des structures de données ;
        \item Lecture des paramètres du problèmes et calcul des grandeurs dérivées ;
        \item Module de calcul des variables ;
        \item Module de détermination des courbes en S, points critiques ;
        \item Module d’intégration, de calcul des pas de temps ;
        \item Programme principal : logique du code et appel des différents modules.
    \end{itemize}
\end{frame}

\begin{frame}
    \begin{algorithm}[H]
        \For{i = 1, n\_iterations}{
            unstable = max($T$ - $T_c$) > 0 {\bf or} max($S$ - $S_c$) > 0\;
            \eIf{unstable}{
                compute($dt_T$)\;
                compute\_exp($S$, $dt_T$)\;
                compute\_exp($T$, $dt_T$)\;
            }{
                compute($dt_\nu$)\;
                compute\_imp($S$, $dt_\nu$)\;
                \While{$T - T_{prev}$ > $\epsilon_T$}{
                    compute\_imp($dt_T$)\;
                    compute\_imp($T$, $dt_T$)\;
                }
                \If{$S - S_{prev}$ > $\epsilon_T$}{
                    Mdot(r\_max) $\times$= 1.05\;
                }
            }
        }
    \end{algorithm}
\end{frame}

\begin{frame}
    \includegraphics[width=\textwidth]{Qmap.pdf}
\end{frame}

\subsection{Domaine stable}
\begin{frame}
  \frametitle{Intégration de $S$ dans le domaine stable}
  \uncover<1->{
    Équation continue:
    \begin{equation}
      \frac{\partial S }{\partial t} = \frac{1}{x^2} \frac{\partial^2}{\partial x^2}\left(\nu S\right)
    \end{equation}
    Discrétisable, 2 choix : dérivée en $S^{t+1}$ ou $S^t$
  }
  \uncover<2->{
    \begin{equation}
      \frac{S_n^{t+1} - S_n^t}{\Delta t} = \frac{1}{{x_n}^2}
      \frac{ S_{n-1}^{t+?}\nu_{n-1}^{t}
        - 2S_{n}^{t+?}\nu_{n}^{t}
        + S_{n+1}^{t+?}\nu_{n+1}^{t}}{\Delta x^2}
    \end{equation}
  }
\end{frame}
\begin{frame}
  \frametitle{Intégration de $S$ dans le domaine stable -- schéma implicite}
  \only<1,4>{
    \begin{equation}\begin{aligned}
      S^{t}_n  &= S_{n-1}^{t+1}\left(-\frac{\Delta t}{\Delta x^2}\frac{\nu_{n-1}^t}{x_n^2}\right)\\
               &+ S_n^{t+1}\left(1 + 2\frac{\Delta t}{\Delta x^2}\frac{\nu_n^t}{x_n^2}\right) \\
               &+ S_{n+1}^{t+1}\left(-\frac{\Delta t}{\Delta x^2}\frac{\nu_{n+1}^t}{x_n^2}\right) \\
    \end{aligned}\end{equation}
}
  \only<2>{
    \begin{equation}\begin{aligned}
      S^{t}_1 &= 0\\
      &+ S_1^{t+1}\left(1 + 2\frac{\Delta t}{\Delta x^2}\frac{\nu_1^t}{x_1^2}\right)\\
      &+ S_{2}^{t+1}\left(-\frac{\Delta t}{\Delta x^2}\frac{\nu_{2}^t}{x_1^2}\right)\\
    \end{aligned}\end{equation}
  }
  \only<3>{
    \begin{equation}\begin{aligned}
      S^{t}_N + \frac{\Delta t}{\Delta x}\frac{\dot{M}_0 }{x_N^2}
                      &= S^{t+1}_{N-1} \left(-\frac{\Delta t}{\Delta x^2}\frac{\nu_{N-1}^t}{x_N^2}\right) \\
                      &+ S_N^{t+1} \left(1 + \frac{\Delta t}{\Delta x^2}\frac{\nu^t_N}{x_N^2}\right )\\
    \end{aligned}\end{equation}
  }
  \uncover<3> {
    Utilise $\frac{\nu_{N+1} S_{N+1} - \nu_{N}S_{N}}{\Delta x} = \dot{M}_0$ 
  }
\end{frame}

\begin{frame}
  \frametitle{Intégration de $S$  dans le domaine stable -- schéma implicite}
  \only<1-2>{
    Équation obtenue:
    
    \begin{equation}
      A^t S^{t+1} = S^{t} + \Lambda^t
    \end{equation}
    $A^t$ est une matrice tridiagonale réelle, $\Lambda^t$ est une vecteur.

    \uncover<2>{
      Solution:
      
      \begin{equation}
        S^{t+1} = \left(A^t\middle)^{-1}\middle[S^t + \Lambda^t\right]
      \end{equation}
    }
  }
  \only<3->{
    On abandonne, et on demande à Lapack. Merci Lapack.
  }
\end{frame}

\begin{frame}
  \frametitle{Intégration de $S$ dans le domaine stable -- schéma implicite}
  {\huge Avantages, inconvénients}
  
  \begin{itemize}
    \item stable $\forall \Delta t > 0$ $\rightarrow$ intégration rapide
    \item peut s'éloigner de la solution physique
  \end{itemize}
  
\end{frame}

\include{integration_T}

\subsection{Domaine instable}

\begin{frame}
  \frametitle{Intégration hors du domaine stable}
  \uncover<1->{
    \begin{equation}\begin{aligned}
      S^{t+1}_n  &= S_{n-1}^{t}\left(\frac{\Delta t}{\Delta x^2}\frac{\nu_{n-1}^t}{x_n^2}\right)\\
               &+ S_n^{t}\left(1 - 2\frac{\Delta t}{\Delta x^2}\frac{\nu_n^t}{x_n^2}\right) \\
               &+ S_{n+1}^{t}\left(\frac{\Delta t}{\Delta x^2}\frac{\nu_{n+1}^t}{x_n^2}\right) \\
    \end{aligned}\end{equation}  
  }
  \uncover<2->{
    Instable ssi
    \begin{equation}
      \bigg(\underbrace{\frac{\Delta x^2}{\Delta t} \bigg.}_\mathrm{vit. num.}\bigg)^{-1} \times
      \underbrace{\bigg.\frac{\nu}{x^2}}_\mathrm{vit. diff.} > 0.5
    \end{equation}
  }
  
\end{frame}

\section{Résultats}
\subsection{Régime stable}

\begin{frame}
  \begin{figure}
\includegraphics[width=\columnwidth]{figures/Ltot_fonction_t_stable.pdf}
    \caption{Évolution température en fonction du temps, $\dot{M}_0 = 10^{-3}\dot{M_c}$.}
  \end{figure}
\end{frame}

\subsection{Régime instable}

\begin{frame}
  \begin{figure}
    \includegraphics[width=.9\columnwidth]{figures/Ltot_fonction_t.pdf}
    \caption{Évolution température en fonction du temps, $\dot{M}_{t=0}$ variable.}
  \end{figure}  
\end{frame}
\end{document}
